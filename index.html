<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Credit Risk Prediction</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { background-color: #f8f9fa; padding: 40px 0; }
    .container { max-width: 800px; }
    .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .result-box { margin-top: 20px; font-size: 1.2em; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card p-4">
      <h2 class="text-center mb-4">ðŸ’³ Credit Risk Assessment</h2>
      <p class="text-muted text-center">Enter customer details to predict loan default risk.</p>

      <form id="creditForm">
        <div class="row mb-3">
          <div class="col-md-6">
            <label>Credit Limit (NT$):</label>
            <input type="number" class="form-control" id="limit_balance" required/>
          </div>
          <div class="col-md-6">
            <label>Age:</label>
            <input type="number" class="form-control" id="age" required/>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label>Sex (1=Male, 2=Female):</label>
            <input type="number" class="form-control" id="sex" min="1" max="2" required/>
          </div>
          <div class="col-md-6">
            <label>Education (1-4):</label>
            <input type="number" class="form-control" id="education" min="1" max="4" required/>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label>Marriage (1=Married, 2=Single, 3=Other):</label>
            <input type="number" class="form-control" id="marriage" min="1" max="3" required/>
          </div>
          <div class="col-md-6">
            <label>Recent Payment Delay (PAY_0):</label>
            <input type="number" class="form-control" id="pay_0" placeholder="-1 to 9" required/>
          </div>
        </div>

        <h5 class="mt-4">Bill Amounts (Last 6 Months)</h5>
        <div class="row mb-3">
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt1" placeholder="Month 1" required/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt2" placeholder="Month 2"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt3" placeholder="Month 3"/></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt4" placeholder="Month 4"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt5" placeholder="Month 5"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="bill_amt6" placeholder="Month 6"/></div>
        </div>

        <h5 class="mt-4">Payments Made (Last 6 Months)</h5>
        <div class="row mb-3">
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt1" placeholder="Paid Month 1" required/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt2" placeholder="Paid Month 2"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt3" placeholder="Paid Month 3"/></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt4" placeholder="Paid Month 4"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt5" placeholder="Paid Month 5"/></div>
          <div class="col-md-4"><input type="number" class="form-control" id="pay_amt6" placeholder="Paid Month 6"/></div>
        </div>

        <div class="text-center mt-4">
          <button type="submit" class="btn btn-success btn-lg">Predict Risk</button>
        </div>
      </form>

      <div class="result-box text-center" id="result">
        <!-- Results will appear here -->
      </div>
    </div>
  </div>

  <script>
    document.getElementById("creditForm").onsubmit = async (e) => {
      e.preventDefault();

      const form = e.target;
      const data = {
        limit_balance: parseFloat(form.limit_balance.value),
        sex: parseInt(form.sex.value),
        education: parseInt(form.education.value),
        marriage: parseInt(form.marriage.value),
        age: parseInt(form.age.value),
        pay_0: parseInt(form.pay_0.value),
        pay_2: parseInt(form.pay_0.value),  // Simplified: assume same as pay_0
        pay_3: parseInt(form.pay_0.value),
        pay_4: parseInt(form.pay_0.value),
        pay_5: parseInt(form.pay_0.value),
        pay_6: parseInt(form.pay_0.value),
        bill_amt1: parseFloat(form.bill_amt1.value) || 0,
        bill_amt2: parseFloat(form.bill_amt2.value) || 0,
        bill_amt3: parseFloat(form.bill_amt3.value) || 0,
        bill_amt4: parseFloat(form.bill_amt4.value) || 0,
        bill_amt5: parseFloat(form.bill_amt5.value) || 0,
        bill_amt6: parseFloat(form.bill_amt6.value) || 0,
        pay_amt1: parseFloat(form.pay_amt1.value) || 0,
        pay_amt2: parseFloat(form.pay_amt2.value) || 0,
        pay_amt3: parseFloat(form.pay_amt3.value) || 0,
        pay_amt4: parseFloat(form.pay_amt4.value) || 0,
        pay_amt5: parseFloat(form.pay_amt5.value) || 0,
        pay_amt6: parseFloat(form.pay_amt6.value) || 0
      };

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await res.json();

        let color = result.risk_level === "High" ? "text-danger" : "text-success";
        document.getElementById("result").innerHTML = `
          <div class="alert alert-${result.risk_level === 'High' ? 'danger' : 'success'}">
            <strong>Risk Level:</strong> ${result.risk_level} <br/>
            <strong>Default Probability:</strong> ${(result.default_probability * 100).toFixed(2)}% <br/>
            <strong>Recommendation:</strong> ${result.recommendation}
          </div>
        `;
      } catch (err) {
        document.getElementById("result").innerHTML = `
          <div class="alert alert-warning">Error: ${err.message}</div>
        `;
      }
    };
  </script>
</body>
</html>